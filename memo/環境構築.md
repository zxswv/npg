# 【完全ガイド】Next.js + Prisma プロジェクトの環境構築手順

### 前提条件

新しい PC に **Git** がインストールされていること。  
新しい PC に **Node.js** (v18 以降を推奨) がインストールされていること。  
新しい PC に **Docker Desktop** がインストールされていること。

[docker-compose-prod.yml](/npg/docker-compose-prod.yml)  
[docker-compose.yml](/npg/docker-compose.yml)  
以上二つの Next.js の構築とネットワークをコメントアウトする。

# 手順

```bash
docker-compose up -d      (データベースを起動)

.env ファイルを作成・編集   (環境変数を設定)

npm install               (パッケージをインストール)

npx prisma migrate dev    (データベースにテーブルを作成)

npm run db:seed           (初期データを投入)

npm run dev               (アプリケーションを起動)
```

## 環境変数の設定

### .env

```bash
# 開発環境ではこちらを使う
DATABASE_URL="postgresql://tt:tt@localhost:5432/DB?schema=public"

DIRECT_URL="postgresql://tt:tt@localhost:5432/DB?schema=public"


# ↓ 以下のURLはnextサーバーを使う際の.env
# DATABASE_URL="postgresql://tt:tt@2mongodb:5432/DB?schema=public"

# DIRECT_URL="postgresql://tt:tt@2mongodb:5432/DB?schema=public"
```

## 依存関係のインストール

```bash
npm install
```

## データベースの構築と初期データの投入

```bash
npx prisma migrate dev
npx prisma generate
npm run db:seed
```

# 開発サーバーの起動

```bash
npm run dev
```

ブラウザを開き、http://localhost:3000 にアクセスします。

# 一度作ったととある人

```bash
npx prisma migrate reset
npm run db:seed
```

# 再度開発環境にする場合

.nev  
docker-compose  
docker-compose-prod  
をコメントアウトした後に

```bash
docker-compose up
npm run db:seed
```

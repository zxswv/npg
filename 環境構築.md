# 【完全ガイド】Next.js + Prisma プロジェクトの環境構築手順

前提条件
```bash
新しいPCに Git がインストールされていること。
新しいPCに Node.js (v18以降を推奨) がインストールされていること。
新しいPCに Docker Desktop がインストールされていること。
あなたのプロジェクトが GitHub などのGitリポジトリで管理されていること。
```
Step 3: 環境変数の設定

プロジェクトに必要な環境変数（データベースの接続URLなど）を設定します。

プロジェクトのルートディレクトリに、.env という名前で新しいファイルを作成します。

元のPCの.envファイルの中身をコピーして、新しいPCの.envファイルに貼り付けます。
【重要】 .envファイルは通常.gitignoreでGitの管理対象外になっているため、この手動コピー作業が必要です。

.envファイルの中身（例）

code
Env
download
content_copy
expand_less
# Prisma Accelerate用の接続文字列
DATABASE_URL="prisma://accelerate.prisma-data.net/..."

# データベースへの直接接続用の文字列
DIRECT_URL="postgresql://myuser:mypassword@localhost:5432/mydatabase?schema=public"

注意: DIRECT_URLのユーザー名、パスワード、データベース名が、あなたのdocker-compose.ymlファイルで定義したものと一致していることを確認してください。

Step 4: 依存関係のインストール

プロジェクトが必要とするnpmパッケージ（Next.js, React, Prismaなど）をインストールします。

ターミナルで以下のコマンドを実行します。

code
Bash
download
content_copy
expand_less
npm install
```    このコマンドは`package.json`と`package-lock.json`を読み込み、必要な全てのパッケージを`node_modules`フォルダにダウンロードします。
Step 5: データベースの構築と初期データの投入

ここが最も重要なステップです。Prismaを使って、データベースのテーブルを作成し、初期データを投入します。

データベースのマイグレーションを実行:
schema.prismaに基づいて、Dockerで起動したデータベースの中にテーブルを作成します。

code
Bash
download
content_copy
expand_less
npx prisma migrate dev

初回実行時は、マイグレーションの適用を確認されるので、yを押して進めてください。

もし「Can't reach database server」のようなエラーが出た場合は、Step 2のDockerが正しく起動しているか、Step 3のDIRECT_URLが正しいかを再確認してください。

Prisma Clientの生成:
通常はmigrate devで自動的に実行されますが、念のため手動でも実行します。これにより、TypeScriptが必要とする型定義ファイルが最新の状態になります。

code
Bash
download
content_copy
expand_less
npx prisma generate

初期データの投入（シーディング）:
作成されたテーブルに、部屋やスケジュールの初期データを投入します。

code
Bash
download
content_copy
expand_less
npm run db:seed
Step 6: 開発サーバーの起動

全ての準備が整いました！

ターミナルで以下のコマンドを実行して、Next.jsの開発サーバーを起動します。

code
Bash
download
content_copy
expand_less
npm run dev

ブラウザを開き、http://localhost:3000にアクセスします。

あなたのアプリケーションが表示され、元のPCと同じように動作することを確認してください。

まとめ：コマンド実行の順番

新しいPCで環境をセットアップする際の正しいコマンドの順番は、常にこうです。

git clone ... (プロジェクトをダウンロード)

docker-compose up -d (データベースを起動)

.envファイルを作成・編集 (環境変数を設定)

npm install (パッケージをインストール)

npx prisma migrate dev (データベースにテーブルを作成)

npm run db:seed (初期データを投入)

npm run dev (アプリケーションを起動)

この手順書をREADME.mdなどに記載しておくと、将来新しいメンバーが加わった際や、あなた自身が再度環境を構築する際にも非常に役立ちます。

```bash
npx prisma migrate reset```

**実行すると、いくつか質問されます:**
*   `Are you sure you want to reset your database? ... This will delete all data. (y/N)`
    （本当にデータベースをリセットしますか？全てのデータが消えますよ）
    → **`y`** と入力してEnterを押してください。

#### このコマンドが実行すること

1.  Dockerコンテナ内で動いているPostgreSQLデータベースの中身を**完全に削除**します。
2.  空の新しいデータベース（スキーマ）を再作成します。
3.  あなたのプロジェクトの`prisma/migrations`フォルダにある**最新のマイグレーション履歴**をすべて適用し、テーブルを再構築します。

結果として、あなたの`schema.prisma`と完全に一致した、クリーンなテーブル構造を持つ、中身が空っぽのデータベースが出来上がります。

---

### 次のステップ

`migrate reset`が正常に完了したら、あとは前回の環境構築手順の続きを実行するだけです。

1.  **初期データの投入（シーディング）:**
    ```bash
    npm run db:seed
    ```

2.  **開発サーバーの起動:**
    ```bash
    npm run dev
    ```

これで、新しいPCでも完全にクリーンで整合性の取れた開発環境が整います！
```